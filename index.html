<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creador de Aulas</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
        background-color: #f4f4f4; margin: 0; padding: 15px;
        display: flex; justify-content: center; align-items: flex-start;
        min-height: 100vh;
      }
      .container {
        width: 100%; max-width: 500px; background: #ffffff;
        padding: 25px; border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        box-sizing: border-box;
      }
      h2 { color: #4285f4; margin-top: 0; }
      div { margin-bottom: 20px; }
      label { display: block; font-weight: bold; margin-bottom: 8px; color: #5f6368; }
      input[type="text"], button {
        width: 100%; padding: 12px; font-size: 16px;
        border: 1px solid #ddd; border-radius: 4px;
        box-sizing: border-box;
      }
      button {
        background-color: #4285f4; color: white; font-weight: bold;
        border: none; cursor: pointer; transition: background-color 0.2s;
      }
      button:hover { background-color: #3367d6; }
      button:disabled { background-color: #9e9e9e; cursor: not-allowed; }
      #status {
        margin-top: 20px; font-weight: bold; font-size: 16px;
        word-wrap: break-word; /* Para que los errores largos no rompan el layout */
      }
      .success { color: green; }
      .error { color: red; }
      .loading { color: #5f6368; }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>Creador de Cursos de Classroom</h2>
      <p>Ingresa los detalles del nuevo curso que deseas crear.</p>
      <div>
        <label for="name">Nombre del Curso:</label>
        <input type="text" id="name" placeholder="Ej: Programación 101">
      </div>
      <div>
        <label for="section">Sección (Horario):</label>
        <input type="text" id="section" placeholder="Ej: Lunes 10:00 - 12:00">
      </div>
      <button id="createButton">Crear Curso</button>
      <div id="status"></div>
    </div>

    <script>
      // !!! PASO FINAL MUY IMPORTANTE !!!
      // Debes pegar aquí la URL de tu *NUEVA IMPLEMENTACIÓN* de Apps Script
      const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwy0x19DeVxRQDoUGczRO4Zc6jFREMw-drJgRsTsRu6dDzsVqX1OgkPI4RTD7-E8pdtNA/exec";

      const button = document.getElementById('createButton');
      const statusDiv = document.getElementById('status');
      const nameInput = document.getElementById('name');
      const sectionInput = document.getElementById('section');

      button.addEventListener('click', handleCreateClick);

      async function handleCreateClick() {
        if (WEB_APP_URL === "¡PEGA_TU_NUEVA_URL_DE_APPS_SCRIPT_AQUÍ!") {
          statusDiv.className = "error";
          statusDiv.innerHTML = "Error: Debes configurar la URL de la API en el archivo index.html";
          return;
        }

        button.disabled = true;
        statusDiv.className = "loading";
        statusDiv.innerHTML = "Creando curso, por favor espera...";

        const courseData = {
          name: nameInput.value,
          section: sectionInput.value
        };

        try {
          const response = await fetch(WEB_APP_URL, {
            method: 'POST',
            mode: 'cors', // Habilitar CORS
            headers: {
              'Content-Type': 'text/plain;charset=utf-8', // Usar text/plain es a veces más simple para Apps Script
            },
            redirect: 'manual', 
            body: JSON.stringify(courseData) // Convertir datos a JSON string
          });
          
          if (response.type === 'opaque' || response.type === 'opaqueredirect') {
             throw new Error("No estás autenticado. Por favor, asegúrate de estar logueado en tu cuenta de Google (Classroom) en este navegador y vuelve a cargar la página.");
          }

          const result = await response.json();

          if (result.status === 'success') {
            statusDiv.className = "success";
            statusDiv.innerHTML = result.message;
            nameInput.value = "";
            sectionInput.value = "";
          } else {
            throw new Error(result.message);
          }

        } catch (error) {
          statusDiv.className = "error";
          // Limpiamos el mensaje de error para que sea más amigable
          let friendlyError = error.message.includes("Failed to fetch") ? "Error de red. Revisa la consola (F12) para detalles de CORS." : error.message;
          if (error.message.includes("text/plain")) {
             friendlyError = "Error de API. Revisa la URL de tu Apps Script.";
          }
          statusDiv.innerHTML = `Error: ${friendlyError}`;
        } finally {
          button.disabled = false;
        }
      }
    </script>
  </body>
</html>
